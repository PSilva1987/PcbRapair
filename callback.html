<!DOCTYPE html>
<html>
<head>
    <title>Spotify Callback</title>
    <script>
        window.onload = function() {
            try {
                if (window.location.hash) {
                    const hash = window.location.hash.substring(1);
                    const params = new URLSearchParams(hash);
                    
                    const tokenData = {
                        type: 'spotify-auth',
                        access_token: params.get('access_token'),
                        expires_in: params.get('expires_in'),
                        token_type: params.get('token_type'),
                        state: params.get('state')
                    };
                    
                    console.log("Dados do token:", tokenData);
                    
                    // Envia para a janela principal
                    if (window.opener) {
                        window.opener.postMessage(tokenData, "https://psilva1987.github.io");
                        setTimeout(() => { window.close() }, 500);
                    } else {
                        document.body.innerHTML = '<h2>Autenticação concluída</h2><p>Feche esta janela e volte ao player.</p>';
                    }
                } else {
                    document.body.innerHTML = '<h2>Erro: Nenhum token recebido</h2>';
                }
            } catch (error) {
                console.error("Erro no callback:", error);
                document.body.innerHTML = `<h2>Erro</h2><p>${error.message}</p>`;
            }
        };
    </script>
</head>
<body>
    <p>Processando autenticação...</p>
</body>
</html>
